# 9장: 다른 문제들

MySQL 운영에서 자주 발생하는 문제들(스플릿-브레인, 데이터 드리프트, 스키마 변경 등)을 다루며, 각 문제에 대한 원인과 해결 방법을 제시함. 데이터 일관성을 유지하는 것이 핵심 과제임.


## 9-1. 스플릿-브레인이 가장 큰 위험이다
- 개념: 스플릿-브레인은 두 개 이상의 MySQL 인스턴스가 동시에 쓰기 작업을 수행할 때 발생하며, 데이터 불일치와 복제 실패를 초래할 수 있음.
- 대처 방법: 즉시 모든 인스턴스에서 쓰기를 중지하고 SET GLOBAL read_only=1을 설정하거나, 심각할 경우 서버를 중단해야 함. 데이터 일관성은 데이터 가용성보다 중요함.

## 9-2. 데이터 드리프트는 실제지만 보이지 않는다
- 개념: 동일한 복제 토폴로지 내 MySQL 인스턴스 간에 데이터가 일관되지 않는 문제로, 이를 "데이터 드리프트"라고 함.
- 해결 방법: pt-table-checksum 도구를 사용하여 주기적으로 드리프트를 확인하고 발견 즉시 조치해야 함. 드리프트는 주로 소규모로 발생하지만 해결이 복잡할 수 있음.

## 9-3. ORM을 믿지 않도록 주의한다
- ORM (Object-Relational Mapping): 데이터 접근을 추상화하지만 성능을 염두에 두지 않으므로, ORM이 생성한 쿼리는 항상 검토하고 성능에 최적화된 쿼리를 수동으로 수정해야 함.
- 주의 사항: ORM 라이브러리가 생성한 쿼리가 비효율적인 경우 ORM 설정을 조정하여 보다 효율적인 쿼리를 생성하도록 해야 함

## 9-4. 스키마는 항상 변경된다
- 스키마 변경: 테이블 정의는 지속적으로 변경되며, 운영 중에도 이를 온라인 스키마 변경(OSC) 방식으로 처리해야 함.
- 해결 방법: pt-online-schema-change나 gh-ost와 같은 도구를 사용하여 스키마를 온라인으로 안전하게 변경하는 방법을 도입해야 함

## 9-5. MySQL 표준 SQL 확장
- MySQL 확장 기능: MySQL은 표준 SQL을 확장하여 많은 기능을 제공하지만, 다른 관계형 데이터베이스와 비교해 제한 사항이 있을 수 있음. 예를 들어, MySQL은 완전 외부 조인을 지원하지 않음.
- 문서 참고: MySQL 매뉴얼을 참고하여 표준 SQL과 MySQL의 차이점을 이해해야 함

## 9-6. 시끄러운 이웃들
- 시끄러운 이웃: 공유 서버에서 지나치게 많은 자원을 사용하는 프로그램이 다른 프로그램의 성능을 저하시킬 때 발생함. 이는 다중 테넌트 환경에서 자주 발생하는 문제.
- 해결 방법: 클라우드 환경에서는 노이즈가 있는 인스턴스를 다시 프로비저닝하는 것이 일반적이며, 물리 서버에서는 문제를 일으키는 프로그램을 다른 서버로 옮기는 방법이 있음

## 9-7. 애플리케이션은 우아하게 실패하지 않는다
- 애플리케이션 장애: MySQL이 비정상적으로 동작하거나 느려지면, 애플리케이션이 적절하게 대응하지 못할 수 있음.
- 대응 방안: 예를 들어 MySQL이 응답하지 않거나 읽기 전용 모드로 전환되는 등 다양한 혼란 상황에서 애플리케이션이 어떻게 반응하는지 미리 테스트해야 함

## 9-8. 고성능 MySQL은 어렵다
- 고성능 달성의 어려움: MySQL의 성능을 최적화하는 것은 매우 복잡하며, 여러 요소를 모두 고려해야 함. 쿼리 최적화뿐만 아니라 전체 워크로드를 최적화해야 함.
- 실제 적용: 이론은 다를 수 있으며, 실전에서 MySQL 성능을 향상시키기 위해서는 많은 연습이 필요함
