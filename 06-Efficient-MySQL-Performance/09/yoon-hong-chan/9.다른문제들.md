# 9. 다른 문제들
- 일반적으로 MySQL 문제를 완화하는 방법을 간략하게 소개
  - 성능과는 직접적인 관련 없지만 간과해서는 안됨

## 9.1 스플릿-브레인이 가장 큰 위험이다
- `스플릿-브레인`이 발생하려면 똑같은 복제 토폴로지에서 발생하려면 2가지 조건을 만족해야함
  - 둘 이상의 MySQL 인스턴스에서 쓰기가 가능(read_only=0)
  - 둘 이상의 MySQL 인스턴스에서 쓰기가 발생
- 복제에 문제가 생기거나 일관되지 않게 되어 `데이터 드리프트`가 발생할 수 있음
- `스플릿-브레인`이 발생하면 반드시 감지하고 즉시 중지해야함
  - 단일 쓰기가 여러 행에 영향을 미칠 수 있음
  - 몇주 동안 데이터 포렌식과 조정이 이루어 질 수도 있음
- `스플릿-브레인` 중지하려면 모든 인스턴스 쓰기를 비활성화 시켜야함 -> 하나의 인스턴스만 쓰기 가능 상태로 두지 말기
  - 쓰기 비활성화 할수 없으면 MySQL이나 서버 종료를 고민해야함 -> 데이터 무결성 > 가용성
- 일치하지 않는 행을 찾는 방법은 `pt-table-sync`를 실행하거나 수동으로 확인하는 방법뿐임
  - `pt-table-sync`는 데이터를 변경하는 도구이므로 주의해서 사용해야함
  - 행 조정은 MySQL 전문가와 협력하여 올바르게 수행되었는지 확인 필요

## 9.2 데이터 드리프트는 실제지만 보이지 않는다.
- `데이터 드리프트`는 일관성 없는 데이터를 의미
  - 하나 이상의 행이 같은 복제 토폴로지의 서로 다른 MySQL 인스턴스에서 서로 다른 값을 가짐
- `스플릿-브레인`에서 일관되지 않은 데이터는 예상되지만, `데이터 드리프트`에서 일관되지 않은 데이터는 예상치 못함
  - `데이터 드리프트`는 문제를 초래하지 않는 다는 점에서 눈에 보이지는 않지만 애플리케이션이 잘못된 값을 반환할 수 있음
- `pt-table-checksum`을 통해 감지 가능 ->비교만 하는 도구이기에 안전함
- `스플릿-브레인`과 비교하여 데이터 조정이 쉽지 않음
- 심각한 오류를 발생시키는 것은 아님
- 실제 프로덕션 데이터베이스에서 데이터 드리프트의 근본 원인을 발견하거나 입증한 적이 없다는 것

## 9.3 ORM을 믿지 않도록 주의한다
- ORM 목적은 데이터 접근을 프로그래밍 용어와 객체로 추상화하여 프로그래머를 지원하는 것
- ORM 라이브러리에서 모든 열을 선택할 수도 있고, 쿼리 전후 다른 쿼리(SHOW WARNINGS)를 실행할 수도 있음
- ORM에서 생성된 쿼리가 너무 비효율적이면, 설명서를 읽고 효율적으로 쿼리를 생성하도록 변경 필요

## 9.4 스키마는 항상 변경된다
- 사용 중인 스키마를 애플리케이션에 영향을 주지 않고 변경하는 것은 중요 -> 아래 3가지 솔루션 존재
  - `pt-online-schema-change`
  - `gh-ost`
  - `ALTER TABLE`
- 각 솔루션은 매우 다르게 동작하지만 모두 애플리케이션에 영향을 주지 않고 온라인으로 테이블 정의 변경 가능 -> 적절한거 선택 후 사용

## 9.5 MySQL 표준 SQL 확장
- MySQL만 사용할때는 문제가 되지 않음
- 다른 DB에서 온 경우, MySQL 메뉴얼의 표준 SQL에 대한 많은 확장이 있다는 것을 유의
  - 전체 외부 조인(full outer join) 미지원
- MySQL은 특정 부분을 제외하면 많은 부분이 메뉴얼이 되어 있으므로 참고
  - 전문가들도 메뉴얼 의존함

## 9.6 시끄러운 이웃들
- 물리적 서버에서 지나치게 많은 시스템 리소스를 사용하여 다른 프로그램의 성능을 떨어뜨리는 프로그램
- 회사 자체 하드웨어에서 발생
  - 시끄러운 이웃을 더 조용한 다른 서버로 이전
- 클라우드에서 발생
  - 직접적인 확인이 힘들기 때문에 클라우드 데이터베이스를 다시 프로비저닝 하기

## 9.7 애플리케이션은 우아하게 실패하지 않는다
- 카오스 엔지니어링은 의도적으로 문제와 장애를 시스템에 도입하여 복원력을 테스트하고 엔지니어가 그 장애에 대비하여 설계함
  - 애플리케이션의 실력을 진정으로 테스트
- 애플리케이션의 성능을 테스트할 수 있는 12가지 데이터베이스에 대한 카오스 시나리오
  - MySQL이 오프라인 상태
  - MySQL은 응답 속도가 매우 느림
  - MySQL은 읽기 전용
  - MySQL이 방금 시작(콜드 버퍼 풀)
  - 읽기 전용 복제본이 오프라인이거나 매우 느림
  - 같은 지역에서 장애 조치(fail over)가 됨
  - 다른 지역을 장애 조치가 됨
  - 데이터베이스 백업이 실행 중
  - DNS 주소 해석이 매우 느림
  - 네트워크가 느리거나 꽉 참
  - RAID 배열에 있는 하나의 하드 드라이브가 성능이 저하됨
  - SSD의 여유 디스크 공간이 5% 미만

## 9.8 고성능 MySQL은 어렵다
- 이 책에서 배운 내용을 애플리케이션에서 적용하기 시작하면 2가지 문제 직면
  - 실제 애플리케이션 쿼리가 이 책에 있는 예보다 복잡
    - 책에서 배운 내용을 적용해보자 
    - 실제 전문가도 쿼리의 전체 내용을 풀고 이해하는 데 시간이 다소 걸림
  - 실제 애플리케이션 성능이 워크로드의 한쪽 측면에 거의 의존하지 않음
    - 전체 워크로드를 통해 더 많은 최적화 필요 -> 이 책에서 얻은 지식 전체 활용
- MySQL 성능에는 이 책에서 제시하는 것보다 더 많은 것이 있지만 제공하는 지식은 포괄적이고 효과적
  - 전문가에게만 알겨진 지식은 없음