# Chapter 9. Other Challenges
* 일반적인 MySQL 문제와 이를 완화하는 방법을 알아본다
## Split-Brain Is the Greatest Risk
* Split-brain 이 발생하려면 다음 조건을 만족해야 한다
    * 쓰기가 가능한 둘 이상의 인스턴스에서 쓰기가 발생
* 데이터가 모든 인스턴스에서 일관되지 않는 현상
* 발생시 반드시 감지하고 즉시 중지해야 한다
    * 모든 인스턴스에서 쓰기를 비활성화
    * 데이터 무결성은 가용성보다 더 중요하기 때문
* `pt-table-sync`를 수행하거나 수동으로 확인하는 방법이 있다
    * 데이터를 변경하는 도구는 위험하므로 사용에 주의해야 한다
## Data Drift Is Real but Invisible
* `Data drift`는 일관성 없는 데이터를 의미한다
* 예상치 못한 경우를 말하기 때문에 모르거나 의심할 이유가 없다
* `pt-table-checksum` 을 사용하여 쉽게 감지할 수 있다
## Don’t Trust ORM
* ORM이 본질적으로 나쁜것은 아니지만 생성된 쿼리를 확인하자
* 예상한 것과 다르게 동작할 수 있기 때문
## Schemas Always Change
* Online schema change는 도전적인 수행과제이다
* `pt-online-schema-change`, `gh-ost`, `ALTER TABLE` 과 같은 방법으로 수행할 수 있다
* 스키마 변경을 개발 프로세스에 통합하는 형태로 안정화 할 수 있는데, 다른 코드 변경과 마찬가지로 팀에서 자체적인 솔루션을 만들어야 한다
    * `Skeema`(www.skeema.io)와 같은 오픈 소스를 참고하자
## MySQL Extends Standard SQL
* MySQL 전문가는 메뉴얼에 의존한다
    * MySQL의 메뉴얼에 모든것이 있는 것은 아니지만 거의 모두 존재한다
## Noisy Neighbors
* 시끄러운 이웃은 시스템 리소스를 너무 많이 사용하여 다른 프로그램의 성능을 떨어뜨린다
* 온프레미스 환경인 경우 리소스 사용량을 측정하여 옮기면 된다
* 클라우드의 경우 공급자가 인정할 리 없다, DB를 다시 프로비저닝하여 성능이 증가하는지 확인하자
## Applications Do Not Fail Gracefully
* MySQL의 카오스 엔지니어링 케이스를 확인해보자(By GPT)
    1. MySQL is offline (MySQL이 오프라인 상태)
        2. MySQL 데이터베이스가 완전히 다운되거나 접근할 수 없는 상태입니다. 이 경우 애플리케이션에서 데이터베이스 연결을 할 수 없으므로 서비스 중단 또는 장애가 발생할 수 있습니다.
    3. MySQL is very slow to respond (MySQL이 매우 느린 응답을 함)
        4. MySQL의 응답 시간이 비정상적으로 길어지는 상황으로, 쿼리가 매우 느리게 실행됩니다. 이는 애플리케이션의 성능을 저하시키고, 타임아웃 오류 또는 서비스 지연을 초래할 수 있습니다.
    5. MySQL is read-only (MySQL이 읽기 전용 상태)
        6. MySQL 데이터베이스가 쓰기 작업을 허용하지 않는 상태로 전환되었습니다. 데이터를 읽을 수는 있지만 새로운 데이터를 삽입하거나 수정할 수 없습니다. 시스템의 일부 기능(예: 데이터 입력)이 비활성화될 수 있습니다.
    7. MySQL has just started (cold buffer pool) (MySQL이 막 시작됨, 콜드 버퍼 풀)
        8. MySQL이 재시작된 직후, 메모리 내 버퍼 풀에 데이터가 캐싱되지 않은 상태입니다. 이 경우 디스크 I/O가 증가하여 쿼리 성능이 떨어질 수 있습니다. 시간이 지남에 따라 캐시가 채워지면서 성능이 회복됩니다.
    9. Read replicas are offline or very slow (읽기 복제본이 오프라인 상태이거나 매우 느림)
        10. 읽기 복제본이 응답하지 않거나 성능이 저하된 상태입니다. 읽기 부하를 분산하기 위해 설정된 복제본이 정상 작동하지 않으면 마스터 데이터베이스에 과부하가 걸리거나, 읽기 요청이 실패할 수 있습니다.
    11. Failover in the same region (동일한 지역 내에서 페일오버 발생)
        12. 동일한 리전(물리적 위치) 내에서 마스터 데이터베이스가 복제본으로 자동 전환되는 상황입니다. 서비스 중단 없이 장애를 복구하는 게 목표지만, 이 과정에서 잠시 동안 서비스가 일시 중지될 수 있습니다.
    13. Failover to a different region (다른 지역으로 페일오버 발생)
        14. 다른 리전으로 데이터베이스 페일오버가 발생하면 더 큰 네트워크 지연이 발생할 수 있습니다. 특히, 데이터 전송 지연 및 응답 시간 증가가 예상됩니다.
    15. Database backup is running (데이터베이스 백업이 실행 중임)
        16. 백업 프로세스가 실행되면서 시스템 리소스를 차지하고 I/O 부하가 증가합니다. 백업 중에는 데이터베이스 성능이 일시적으로 저하될 수 있으며, 대량의 데이터 백업 시 서비스 지연이 발생할 수 있습니다.
    17. DNS resolution is very slow (DNS 해석이 매우 느림)
        18. DNS 조회 속도가 느려져 MySQL 서버에 연결할 때 지연이 발생합니다. MySQL 호스트 이름을 IP 주소로 변환하는 데 시간이 오래 걸리면, 전체적인 연결 지연으로 이어질 수 있습니다.
    19. Network is slow (high latency) or saturated (네트워크가 느리거나 포화 상태)
        20. 네트워크 대역폭 부족 또는 높은 지연 시간으로 인해 MySQL 서버와의 통신이 느려집니다. 데이터 전송 속도가 느려져 쿼리 실행 시간이 길어질 수 있습니다.
    21. One hard drive in a RAID array is degraded (RAID 배열의 하드 드라이브 하나가 저하됨)
        22. RAID 구성에서 한 개의 디스크가 손상되었거나 성능이 저하되었습니다. 이 경우 I/O 성능이 저하되고, 디스크가 교체되기 전까지 시스템 안정성이 감소할 수 있습니다.
    23. Free disk space on an SSD is less than 5% (SSD의 남은 디스크 공간이 5% 미만임)
        24. 디스크 공간이 거의 다 찬 상태로, MySQL이 로그를 쓰거나 데이터를 저장하는 데 문제가 생길 수 있습니다. 공간 부족으로 인해 데이터베이스 성능이 저하되거나 쓰기 작업이 실패할 수 있습니다.
## High Performance MySQL Is Difficult
* 책의 내용을 적용하려고 하면 2가지 문제에 직면한다
    1. 쿼리가 책에 있는것보다 더 복잡하다
        2. 자세히 분석하는 수밖에 없다!
    2. Application의 성능이 워크로드의 한쪽면에만 의존하지 않는다
        3. 하나씩 적용해나가자