# 구글 맵
* 구글 맵은 위성 이미지, 거리 뷰, 실시간 교통 상황, 경로 계획을 제공하고 있다
* DAU 10억, 세계99% 지역의 지도를 제공하고, 매일 2500만 건의 업데이트를 반영한다

## 1단계: 문제 이해 및 설계 범위 확정
* 주요 초점은 위치 갱신, 경로 안내, ETA, 지도 표시
* 도로 데이터는 이미 존재한다
* 교통 상황을 반영하여 ETA/경로 안내가 가능해야 한다
* 다양한 이동 방법을 지원한다
* 경유지 설정 기능은 생략한다
* 사업장에 대한 사진 정보도 생략한다

### 기능 요구사항
* 사용자의 위치를 갱신할 수 있다
* 경로를 안내하고 도착 예정시간을 알 수 있다
* 지도가 표시되어야 한다
> 지도가 표시되어야 한다는 기능 요구사항은 다소 모호하다
### 비기능 요구사항 및 제약사항
* 경로 안내는 정확해야 한다
* 경로 표시는 화면에 부드럽게 표시되고 갱신되어야 한다
* 가능한 한 최소한의 데이터와 배터리를 사용해야 한다
* 일반적인 가용성 및 규모 확장성을 만족해야 한다
> 일반적인 가용성 : 99.99% ?
### 3차원 위치의 2차원 변환
* 다양한 도법이 존재한다
* 구글 맵은 웹 메르카토르 도법 사용

https://medium.com/google-design/google-maps-cb0326d165f5

### Geocoding
* 주소를 지리적 측위 시스템의 좌표로 변환하는 프로세스
* 주소 -> 위경도로 변환

https://en.wikipedia.org/wiki/Address_geocoding

### Geohashing
* 1,2장에서 많이 얘기했으므로 생략

### 지도 표시
* 맵 표시의 기본은 타일이다
* 전체를 하나의 이미지로 표현하는 대신 작은 타일로 쪼개어 표시
* 확대/축소를 지원하려면 확대 수준에 따라 다른 종류의 타일을 준비한다

### 경로 안내 알고리즘을 위한 도로 데이터 처리
* 경 로탐색 알고리즘은 대부분 Djikstra or A*의 변종이다
* 교차로를 노드로, 도로는 노드를 잇는 선으로 표현하는 그래프 자료 구조를 가정한다
* 대부분의 경로 탐색 알고리즘은 그래프 크기에 민감하므로 관리 가능 단위로 분할할 필요가 있다
* 지도 표시에서 사용되는 타일형태로 그래프를 분할해서 처리하면 유리하다
* [Djikstra](https://ko.wikipedia.org/wiki/%EB%8D%B0%EC%9D%B4%ED%81%AC%EC%8A%A4%ED%8A%B8%EB%9D%BC_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98)
* [A*](https://ko.wikipedia.org/wiki/A*_%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98)

### 계층적 경로 안내 타일
* 지도의 확대 축소와 유사하게 경로 탐색에도 구체성 정도로 구분한 경로 안내 타일을 사용한다
> 네이버 지도의 경로 찾기도 유사한 형태로 동작하는듯 하다
>
> 가까운 거리는 시내버스를 안내하지만 멀어지면 ktx/고속버스나 고속도로의 안내만 나옴
>
> 예를들어 서울-부산을 탐색했을때 각 지역의 시내버스 구간을 탐색해주지는 않는다

### 개략적 규모 추정
#### 저장소 사용량
* 필요한 데이터의 종류는 아래 세 가지가 있다
    * 세계 지도
    * 메타데이터
    * 도로 정보

**세계 지도**
* 세계 지도를 21번 확대할 수 있다고 하면 최대 확대에서 4.4조개의 타일이 필요하다
* 개당 100KB라고 가정하면 440PB의 저장 공간이 필요하다
* 다만 지구의 대부분은 사람이 살지 않는 곳이므로 90%의 절감이 가능하다 가정하면 50PB 정도로 줄일 수 있다

**서버 대역폭**
* 대역폭 추정을 위해서는 어떤 유형의 요청을 처리해야 하는지 살펴봐야 한다

1. 경로 안내 요청
2. 위치 갱신 요청
* 10억 사용자가 주당 35분 사용한다면 주당 350억 분, 하루에 50억 분이다
* 매초 전송한다고 가정하면 하루 3,000억 초당 300만 qps가 발생한다
* 매초 새로운 좌표를 보낼 필요는 없을 것이므로 15 또는 30초마다 한번씩 보내어 낮출 수 있다
* 15초마다 한번 보낸다고 가정하면 qps는 20만, 최대를 5배로 가정할대 최대 qps는 100만이 된다
## 2단계: 개략적 설계안 제시 및 동의 구하기


## 3단계: 상세 설계
## 4단계: 마무리
